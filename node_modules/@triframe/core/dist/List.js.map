{"version":3,"sources":["../src/List.js"],"names":["List","Array","constructor","elements","createObservable","observe","emit","push","Object","defineProperty","enumerable","value","EventEmitter","filter","callback","thisArg","undefined","result","forEach","element","index","call","map","reverse","length","on","args","patches","op","path","_splice","splice","deleted","origin","Math","min","replacementPatches","i","removedPatches","additionPatches","insert","patch","replace","mapInPlace","remove","start","end","resource","agent","monitor","node","isPlain","key","get","set","newValue","crawl","primativeTypes","includes","name","obj"],"mappings":"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","sourcesContent":["import { EventEmitter } from './EventEmitter'\r\nimport { each } from './iterators'\r\n\r\nexport class List extends Array {\r\n\r\n    constructor(...elements) {\r\n        super()\r\n        createObservable(elements).observe( () => this.emit('Δ.change', []))\r\n        super.push(...elements)\r\n        Object.defineProperty(this, '[[patches]]', {\r\n            enumerable: false,\r\n            value: []\r\n        })\r\n        Object.defineProperty(this, '[[events]]', {\r\n            enumerable: false,\r\n            value: new EventEmitter\r\n        })\r\n    }\r\n\r\n    filter(callback, thisArg = undefined){\r\n        let result = new List\r\n        this.forEach( (element, index) => {\r\n            if(callback.call(thisArg, element, index, this)){\r\n                result.push(element)\r\n            }\r\n        })\r\n        return result\r\n    }\r\n\r\n    map(callback, thisArg = undefined){\r\n        let result = new List\r\n        this.forEach( (element, index) => {\r\n            result[index] = callback.call(thisArg, element, index, this)\r\n        })\r\n        return result\r\n    }\r\n\r\n    reverse(){\r\n        let result = new List\r\n        this.forEach( (element, index) => {\r\n            result[this.length - index] = element\r\n        })\r\n        return result\r\n    }\r\n\r\n    on(...args) {\r\n        return this['[[events]]'].on(...args)\r\n    }\r\n\r\n    emit(...args) {\r\n        return this['[[events]]'].emit(...args)\r\n    }\r\n\r\n    push(...elements) {\r\n        let length = this.length\r\n        let patches = elements.map(element => ({\r\n            op: 'add',\r\n            path: `/${length++}`,\r\n            value: element\r\n        }))\r\n        createObservable(elements).observe( () => this.emit('Δ.change', []))\r\n        this[\"[[patches]]\"].push(...patches)\r\n        super.push(...elements)\r\n        this.emit('Δ.change', patches)\r\n    }\r\n\r\n    _splice(...args){\r\n        return super.splice(...args)\r\n    }\r\n\r\n    splice(index, deleted, ...elements) {\r\n        super.splice(index, deleted, ...elements)\r\n        \r\n        let origin = Math.min(deleted + index, elements.length + index)\r\n    \r\n        let replacementPatches = []\r\n        for(let i = index; i < origin; i++) replacementPatches.push({\r\n            op: 'replace',\r\n            path: `/${i}`,\r\n            value: elements[i - index]\r\n        })\r\n\r\n        let removedPatches = []\r\n        for(let i = origin; i < index + deleted; i++) removedPatches.push({\r\n            op: 'remove',\r\n            path: `/${i}`,\r\n        })\r\n\r\n        let additionPatches = []\r\n        for(let i = origin; i < index + elements.length; i++) removedPatches.push({\r\n            op: 'add',\r\n            path: `/${i}`,\r\n            value: elements[i - index]\r\n        })\r\n\r\n        let patches = [ ...replacementPatches, ...removedPatches, ...additionPatches ]\r\n\r\n        this[\"[[patches]]\"].push(...patches)\r\n        this.emit('Δ.change', patches)\r\n    }\r\n\r\n    insert(element, index) {\r\n        super.splice(index, 0, element)\r\n        let patch = {\r\n            op: 'add',\r\n            path: `/${index}`,\r\n            value: element\r\n        }\r\n        this[\"[[patches]]\"].push(patch)\r\n        this.emit('Δ.change', [patch])\r\n    }\r\n\r\n\r\n    replace(index, value) {\r\n        this[index] = value\r\n        let patch = {\r\n            op: 'replace',\r\n            path: `/${index}`,\r\n            value\r\n        }\r\n        this[\"[[patches]]\"].push(patch)\r\n        this.emit('Δ.change', [patch])\r\n    }\r\n\r\n\r\n    mapInPlace(callback) {\r\n        let patches = []\r\n        this.forEach((element, index) => {\r\n            let value = callback(element, index)\r\n            if (value != element) {\r\n                this[index] = value\r\n                let patch = {\r\n                    op: 'replace',\r\n                    path: `/${index}`,\r\n                    value\r\n                }\r\n                patches.push(patch)\r\n            }\r\n        })\r\n        this[\"[[patches]]\"].push(...patches)\r\n        this.emit('Δ.change', patches)\r\n    }\r\n\r\n\r\n    remove(start, end = null) {\r\n        if (end == null) end = start\r\n        super.splice(start, 1 + end - start)\r\n        let patches = []\r\n        for (let index = start; index <= end; index++) {\r\n            patches.push({\r\n                op: 'remove',\r\n                path: `/${start}`\r\n            })\r\n        }\r\n        this[\"[[patches]]\"].push(...patches)\r\n        this.emit('Δ.change', patches)\r\n    }\r\n}\r\n\r\nlet createObservable = resource => {\r\n    const agent = new EventEmitter;\r\n    const monitor = node => {\r\n        if (typeof node.on === 'function') node.on('Δ.change', () => agent.emit(`change`))\r\n        else if(isPlain(node)) each(node, (key, value) => {\r\n            Object.defineProperty(node, key, {\r\n                enumerable: true,\r\n                get: () => value,\r\n                set: newValue => {\r\n                    value = newValue\r\n                    agent.emit(`change`)\r\n                }\r\n            })\r\n        })\r\n    }\r\n    crawl(resource, monitor)\r\n    return agent.on('change')\r\n}\r\nconst primativeTypes = ['String', 'Boolean', 'Number', 'Date', 'Function']\r\nconst isPlain = value => value && typeof value === 'object' && !primativeTypes.includes(value.constructor.name) && typeof value.on !== 'function'\r\nconst crawl = (obj, callback) => {\r\n    callback(obj)\r\n    if (isPlain(obj)) {\r\n        for (let key in obj) {\r\n            callback(obj[key])\r\n            let value = obj[key]\r\n            crawl(value, callback)\r\n        }\r\n    }\r\n}"],"file":"List.js"}