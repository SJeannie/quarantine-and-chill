{"version":3,"sources":["../src/Pipe.js"],"names":["execute","Symbol","pending","Pipe","constructor","process","args","currentValue","listeners","observers","Promise","all","map","listener","observer","err","errorHandlers","forEach","handler","cursor","aborted","abortThis","index","executions","push","emit","length","abort","shift","throw","throwError","pipe","call","thisArg","value","done","isPipe","isPromise","isObservable","cached","cache","cachedPromise","next","undefined","moveCursor","Error","dependencies","apply","result","then","catch","cachedResource","getCachedResource","cacheResource","isCanceled","latency","timer","setTimeout","observe","onCancel","unobserve","cachedPipe","find","dependency","isEqual","destroy","resource","id","uid","resources","JSON","stringify","Array","isArray","alreadyInitialized","callback","cachedValue","filter","errorHandler","catchHandler","resolve","ref","cancelationHandlers","forceReload","agent","EventEmitter","monitor","node","on","isPlain","key","Object","defineProperty","enumerable","get","set","newValue","crawl","debounce","toJSON","primativeTypes","includes","name","obj"],"mappings":"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","sourcesContent":["import { each } from \"./iterators\"\r\nimport { EventEmitter } from './EventEmitter'\r\n\r\nconst execute = Symbol()\r\nconst pending = Symbol()\r\n\r\n\r\nexport class Pipe {\r\n\r\n    latency = false\r\n    listeners = []\r\n    observers = []\r\n    dependencies = []\r\n    errorHandlers = []\r\n    cancelationHandlers = []\r\n\r\n    executions = []\r\n\r\n    currentValue = pending\r\n\r\n    resources = {}\r\n\r\n\r\n    constructor(process, ...args) {\r\n        let thisArg;\r\n        if (Array.isArray(process)) {\r\n            thisArg = process[0];\r\n            process = process[1];\r\n        }\r\n        this.process = process\r\n        this.thisArg = thisArg\r\n        this.args = args\r\n        setTimeout(() => {\r\n            if (!this.alreadyInitialized && !this.isCanceled) this[execute]()\r\n        })\r\n    }\r\n\r\n    observe(callback) {\r\n        if (this.cachedValue) callback(this.cachedValue)\r\n        this.observers.push(callback)\r\n        return this\r\n    }\r\n\r\n    unobserve(callback) {\r\n        this.observers = this.observers.filter(observer => observer != callback)\r\n        if (this.observers.length == 0) {\r\n            this.destroy()\r\n        }\r\n    }\r\n\r\n    then(callback, errorHandler = () => void (0)) {\r\n        if (this.currentValue !== pending) return this.currentValue instanceof Error\r\n            ? errorHandler(this.currentValue)\r\n            : callback(this.currentValue)\r\n        let catchHandler = (err) => {\r\n            this.errorHandlers = this.errorHandlers.filter(handler => handler != catchHandler)\r\n            errorHandler(err)\r\n        }\r\n        this.catch(catchHandler)\r\n        let resolve = () => resolve = true\r\n        this.listeners.push(async (...args) => {\r\n            this.errorHandlers = this.errorHandlers.filter(handler => handler != catchHandler)\r\n            if (resolve !== true) await callback(...args)\r\n            resolve()\r\n        })\r\n        return new Promise(ref => resolve === true ? ref() : resolve = ref)\r\n    }\r\n\r\n    catch(callback) {\r\n        this.errorHandlers.push(callback)\r\n    }\r\n\r\n    onCancel(callback) {\r\n        if (this.isCanceled) callback()\r\n        else this.cancelationHandlers.push(callback)\r\n    }\r\n\r\n    apply(callback, errorHandler = () => void (0)) {\r\n        if (this.currentValue != pending) {\r\n            if (this.currentValue instanceof Error) errorHandler(this.currentValue)\r\n            else callback(this.currentValue)\r\n        } else {\r\n            this.then(callback, errorHandler);\r\n            this.alreadyInitialized = true;\r\n            this[execute]()\r\n        }\r\n    }\r\n\r\n    emit = async (...args) => {\r\n        this.currentValue = args[0];\r\n        let listeners = [...this.listeners]\r\n        let observers = [...this.observers]\r\n        this.listeners = []\r\n        await Promise.all([\r\n            ...listeners.map(listener => listener(...args)),\r\n            ...observers.map(observer => observer(...args))\r\n        ])\r\n    }\r\n\r\n    throwError = (err) => {\r\n        this.currentValue = err\r\n        this.errorHandlers.forEach(handler => handler(err))\r\n    }\r\n\r\n    forceReload() {\r\n        this[execute]()\r\n    }\r\n\r\n    [execute] = async () => {\r\n        let cursor;\r\n        let aborted = false\r\n        let abortThis = () => aborted = true\r\n        let index = 0;\r\n\r\n        this.executions.push(abortThis)\r\n\r\n        let emit = (...args) => {\r\n            if (aborted) return\r\n            while (this.executions.length && this.executions[0] != abortThis) {\r\n                let abort = this.executions.shift()\r\n                abort()\r\n            }\r\n            this.executions.shift()\r\n            this.emit(...args)\r\n        }\r\n\r\n        emit.throw = this.throwError\r\n        emit.pipe = this\r\n\r\n\r\n        try {\r\n            cursor = this.process.call(this.thisArg, emit, ...this.args)\r\n        } catch (err) {\r\n            this.throwError(err)\r\n        }\r\n\r\n        const process = ({ value, done }) => {\r\n\r\n            const { isPipe, isPromise, isObservable } = this.constructor\r\n            const { cached, cache } = this\r\n            const cachedPromise = cached(value)\r\n\r\n            const throwError = err => {\r\n                if (cursor.throw) {\r\n                    return process(cursor.throw(err))\r\n                } else {\r\n                    return this.throwError(err)\r\n                }\r\n            }\r\n\r\n            let next;\r\n            if (done && value === undefined) return\r\n            if (done) next = (...args) => !aborted && emit(...args)\r\n            else next = (...args) => !aborted && moveCursor(...args)\r\n            return new Promise(async () => {\r\n                if (cachedPromise) cachedPromise.currentValue instanceof Error\r\n                    ? throwError(cachedPromise.currentValue)\r\n                    : await next(await cachedPromise);\r\n                else if (isPipe(value)) {\r\n                    this.dependencies.push(value)\r\n                    value.apply(result => {\r\n                        cache(value);\r\n                        next(result);\r\n                    }, err => {\r\n                        cache(value)\r\n                        throwError(err)\r\n                    });\r\n                }\r\n                else if (isPromise(value)) {\r\n                    await value\r\n                        .then(next)\r\n                        .catch(err => throwError(err))\r\n                } else {\r\n                    index++\r\n                    const cachedResource = this.getCachedResource(value, index)\r\n                    if (cachedResource) {\r\n                        await next(cachedResource)\r\n                    } else {\r\n                        if (!done) this.cacheResource(value, index)\r\n                        await next(value)\r\n                    }\r\n                }\r\n            })\r\n        }\r\n\r\n        const moveCursor = result => {\r\n            try {\r\n                result = cursor.next(result)\r\n                process(result)\r\n            } catch (err) {\r\n                this.throwError(err)\r\n            }\r\n        }\r\n\r\n        if (cursor && typeof cursor.next == 'function') await moveCursor();\r\n        else await process({ value: cursor, done: true })\r\n    }\r\n\r\n    cache = pipe => {\r\n        let observer = (err) => {\r\n            if ((this.observers.length || this.listeners.length) && !this.isCanceled) {\r\n                if (this.latency === false) this[execute]()\r\n                else if (!this.timer) this.timer = setTimeout(() => {\r\n                    this[execute]()\r\n                    this.timer = false\r\n                }, this.latency)\r\n            }\r\n        }\r\n        pipe.catch(observer)\r\n        pipe.observe(observer)\r\n        this.onCancel(() => pipe.unobserve(observer))\r\n    }\r\n\r\n    destroy() {\r\n        this.isCanceled = true\r\n        this.cancelationHandlers.forEach(callback => callback())\r\n    }\r\n\r\n    cached = pipe => {\r\n        let cachedPipe = this.dependencies.find(dependency => dependency.isEqual(pipe))\r\n        if (cachedPipe) {\r\n            if (cachedPipe !== pipe) {\r\n                pipe.destroy()\r\n            }\r\n            return cachedPipe\r\n        }\r\n    }\r\n\r\n    cacheResource(resource, index) {\r\n        if (!resource) return resource\r\n        let id;\r\n        if (resource.uid) {\r\n            id = resource.uid\r\n        } else {\r\n            id = `${index}`\r\n            if (this.currentValue != pending && this.resources[id] === undefined) {\r\n                throw Error('A new resource without a uid was conditionally yielded. This behavior is not supported, as TriFrame will not know where to properly yield state. Please give your resources unique `uid` properties')\r\n            }\r\n        }\r\n\r\n        this.resources[id] = resource\r\n        const agent = new EventEmitter;\r\n        const monitor = node => {\r\n            if (node && typeof node.on === 'function') node.on('Δ.change', () => agent.emit(`change`))\r\n            else if(isPlain(node)) each(node, (key, value) => {\r\n                Object.defineProperty(node, key, {\r\n                    enumerable: true,\r\n                    get: () => value,\r\n                    set: newValue => {\r\n                        value = newValue\r\n                        agent.emit(`change`)\r\n                    }\r\n                })\r\n            })\r\n        }\r\n        this.cache(agent.on('change'))\r\n        crawl(resource, monitor)\r\n    }\r\n\r\n    getCachedResource = (resource = {}, index) => {\r\n        if (!resource) return\r\n        let id = resource.uid || `${index}`\r\n        return this.resources[id]\r\n    }\r\n\r\n    isEqual = pipe => pipe && pipe.process == this.process && JSON.stringify(pipe.args) === JSON.stringify(this.args) && (pipe.thisArg == this.thisArg || !pipe.thisArg || !this.thisArg || this.thisArg.id == pipe.thisArg.id)\r\n\r\n    static isPipe = value => value && typeof value.observe == 'function'\r\n\r\n    static isPromise = value => value && typeof value.then == 'function'\r\n\r\n    debounce(latency = 0) {\r\n        this.latency = latency\r\n        return this\r\n    }\r\n\r\n    toJSON() {\r\n        return {}\r\n    }\r\n\r\n}\r\n\r\nconst primativeTypes = ['String', 'Boolean', 'Number', 'Date', 'Function']\r\nconst isPlain = value => value && typeof value === 'object' && !primativeTypes.includes(value.constructor.name) && typeof value.on !== 'function'\r\nconst crawl = (obj, callback) => {\r\n    callback(obj)\r\n    if (isPlain(obj)) {\r\n        for (let key in obj) {\r\n            callback(obj[key])\r\n            let value = obj[key]\r\n            crawl(value, callback)\r\n        }\r\n    }\r\n}"],"file":"Pipe.js"}