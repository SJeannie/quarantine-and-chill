{"version":3,"sources":["../src/decorators.js"],"names":["string","createPropertyDecorator","decoratorArgs","datatype","constraints","text","numeric","float","integer","boolean","timestamp","sqlEncode","value","DateTime","toJSDate","sqlDecode","Date","fromJSDate","fromISO","timestamptz","date","time","point","line","lseg","path","polygon","circle","list","JSON","stringify","parse","err","json","serial","pk","primaryKey","derive","createDecorator","opts","target","key","fieldValue","sql","code","Error","Object","defineProperty","createDocumentProperty","isShared","type","definition","defaultValue","temp","hasMany","options","joinType","hasOne","belongsTo","foreignKey","hidden","readAccessTest","readonly","writeAccessTest","hiddenUnless","readonlyUnless","shared","session","usesSession","validate","forEach","validator","validation","addHandler","validators","include","models","decorated","register","Class","constructor","prototype","Model","getOwnPropertyDescriptors","descriptor","metadata","isEmpty","__proto__","handlers","initialize","object","onConstruct","call","createStream","method","prependEmit","process","emit","args","unshift","Pipe","stream","original","isStream","wrap","x","define","decorator","initializer","writable","kind","placement","isMethod","undefined","enumerable","get","Function","set","callback","previous","finisher","Symbol","extras","keys","length"],"mappings":";;;;;;;AAAA;;;;;;;;AAGA;AAEO,MAAMA,MAAM,WAANA,MAAM,GAAGC,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AAClEC,EAAAA,QAAQ,EAAE,SADwD;AAElEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB;AAFiC,CAAxB,CAAD,CAAtC;AAKA,MAAMG,IAAI,WAAJA,IAAI,GAAGJ,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AAChEC,EAAAA,QAAQ,EAAE,MADsD;AAEhEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB;AAF+B,CAAxB,CAAD,CAApC;AAKA,MAAMI,OAAO,WAAPA,OAAO,GAAGL,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AACnEC,EAAAA,QAAQ,EAAE,SADyD;AAEnEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB;AAFkC,CAAxB,CAAD,CAAvC;AAKA,MAAMK,KAAK,WAALA,KAAK,GAAGN,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AACjEC,EAAAA,QAAQ,EAAE,QADuD;AAEjEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB;AAFgC,CAAxB,CAAD,CAArC;AAKA,MAAMM,OAAO,WAAPA,OAAO,GAAGP,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AACnEC,EAAAA,QAAQ,EAAE,MADyD;AAEnEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB;AAFkC,CAAxB,CAAD,CAAvC;AAKA,MAAMO,OAAO,WAAPA,OAAO,GAAGR,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AACnEC,EAAAA,QAAQ,EAAE,MADyD;AAEnEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB;AAFkC,CAAxB,CAAD,CAAvC;AAKA,MAAMQ,SAAS,WAATA,SAAS,GAAGT,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AACrEC,EAAAA,QAAQ,EAAE,aAD2D;AAErEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB,EAFoC;AAGrES,EAAAA,SAAS,EAAEC,KAAK,IAAIA,KAAK,YAAYC,cAAjB,GAA4BD,KAAK,CAACE,QAAN,EAA5B,GAA+CF,KAHE;AAIrEG,EAAAA,SAAS,EAAEH,KAAK,IAAIA,KAAK,YAAYI,IAAjB,GAAwBH,eAASI,UAAT,CAAoBL,KAApB,CAAxB,GAAqDC,eAASK,OAAT,CAAiBN,KAAjB;AAJJ,CAAxB,CAAD,CAAzC;AAOA,MAAMO,WAAW,WAAXA,WAAW,GAAGlB,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AACvEC,EAAAA,QAAQ,EAAE,aAD6D;AAEvEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB;AAFsC,CAAxB,CAAD,CAA3C;AAKA,MAAMkB,IAAI,WAAJA,IAAI,GAAGnB,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AAChEC,EAAAA,QAAQ,EAAE,MADsD;AAEhEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB;AAF+B,CAAxB,CAAD,CAApC;AAKA,MAAMmB,IAAI,WAAJA,IAAI,GAAGpB,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AAChEC,EAAAA,QAAQ,EAAE,MADsD;AAEhEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB;AAF+B,CAAxB,CAAD,CAApC;AAKA,MAAMoB,KAAK,WAALA,KAAK,GAAGrB,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AACjEC,EAAAA,QAAQ,EAAE,OADuD;AAEjEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB;AAFgC,CAAxB,CAAD,CAArC;AAKA,MAAMqB,IAAI,WAAJA,IAAI,GAAGtB,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AAChEC,EAAAA,QAAQ,EAAE,MADsD;AAEhEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB;AAF+B,CAAxB,CAAD,CAApC;AAKA,MAAMsB,IAAI,WAAJA,IAAI,GAAGvB,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AAChEC,EAAAA,QAAQ,EAAE,MADsD;AAEhEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB;AAF+B,CAAxB,CAAD,CAApC;AAKA,MAAMuB,IAAI,WAAJA,IAAI,GAAGxB,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AAChEC,EAAAA,QAAQ,EAAE,MADsD;AAEhEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB;AAF+B,CAAxB,CAAD,CAApC;AAKA,MAAMwB,OAAO,WAAPA,OAAO,GAAGzB,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AACnEC,EAAAA,QAAQ,EAAE,SADyD;AAEnEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB;AAFkC,CAAxB,CAAD,CAAvC;AAKA,MAAMyB,MAAM,WAANA,MAAM,GAAG1B,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AAClEC,EAAAA,QAAQ,EAAE,QADwD;AAElEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB;AAFiC,CAAxB,CAAD,CAAtC;AAKA,MAAM0B,IAAI,WAAJA,IAAI,GAAG3B,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AAChEC,EAAAA,QAAQ,EAAE,MADsD;AAEhEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB,EAF+B;AAGhES,EAAAA,SAAS,EAAEC,KAAK,IAAIiB,IAAI,CAACC,SAAL,CAAelB,KAAf,CAH4C;AAIhEG,EAAAA,SAAS,EAAEH,KAAK,IAAI;AAChB,QAAI;AACA,aAAOiB,IAAI,CAACE,KAAL,CAAWnB,KAAX,CAAP;AACH,KAFD,CAEE,OAAOoB,GAAP,EAAY;AACV,aAAOpB,KAAP;AACH;AACJ;AAV+D,CAAxB,CAAD,CAApC;AAaA,MAAMqB,IAAI,WAAJA,IAAI,GAAGhC,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AAChEC,EAAAA,QAAQ,EAAE,MADsD;AAEhEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB,EAF+B;AAGhES,EAAAA,SAAS,EAAEC,KAAK,IAAIiB,IAAI,CAACC,SAAL,CAAelB,KAAf,CAH4C;AAIhEG,EAAAA,SAAS,EAAEH,KAAK,IAAI;AAChB,QAAI;AACA,aAAOiB,IAAI,CAACE,KAAL,CAAWnB,KAAX,CAAP;AACH,KAFD,CAEE,OAAOoB,GAAP,EAAY;AACV,aAAOpB,KAAP;AACH;AACJ;AAV+D,CAAxB,CAAD,CAApC;AAaA,MAAMsB,MAAM,WAANA,MAAM,GAAGjC,uBAAuB,CAAC,CAAC;AAAEC,EAAAA;AAAF,CAAD,MAAwB;AAClEC,EAAAA,QAAQ,EAAE,QADwD;AAElEC,EAAAA,WAAW,EAAEF,aAAa,CAAC,CAAD,CAAb,IAAoB;AAFiC,CAAxB,CAAD,CAAtC;AAKA,MAAMiC,EAAE,WAAFA,EAAE,GAAGD,MAAM,CAAC;AAAEE,EAAAA,UAAU,EAAE;AAAd,CAAD,CAAjB;AAEA,MAAMC,MAAM,WAANA,MAAM,GAAGC,eAAe,CAAC,CAAC;AAAEpC,EAAAA,aAAa,EAAE,CAACqC,IAAD,CAAjB;AAAyBC,EAAAA,MAAzB;AAAiCC,EAAAA,GAAjC;AAAsCC,EAAAA;AAAtC,CAAD,KAAwD;AAC1F,MAAI,CAACH,IAAI,CAACI,GAAN,IAAa,CAACJ,IAAI,CAACK,IAAvB,EAA6B,MAAMC,KAAK,CAAE,2EAA0EJ,GAAI,GAAhF,CAAX;AAC7BK,EAAAA,MAAM,CAACC,cAAP,CAAsBP,MAAtB,EAA8BC,GAA9B,EAAmCO,sBAAsB,CAACP,GAAD,CAAzD;AACA,SAAO;AACHQ,IAAAA,QAAQ,EAAE,IADP;AAEHC,IAAAA,IAAI,EAAEX,IAAI,CAACI,GAAL,GAAW,aAAX,GAA2B,cAF9B;AAGHQ,IAAAA,UAAU,EAAEZ,IAAI,CAACI,GAAL,IAAYJ,IAAI,CAACK,IAH1B;AAIHQ,IAAAA,YAAY,EAAEV;AAJX,GAAP;AAMH,CAToC,CAA9B;AAWA,MAAMW,IAAI,WAAJA,IAAI,GAAGpD,uBAAuB,CAAC,CAAC;AAAEC,EAAAA,aAAa,EAAE,CAACqC,IAAD,CAAjB;AAAyBC,EAAAA,MAAzB;AAAiCC,EAAAA,GAAjC;AAAsCC,EAAAA;AAAtC,CAAD,KAAwD;AAChGI,EAAAA,MAAM,CAACC,cAAP,CAAsBP,MAAtB,EAA8BC,GAA9B,EAAmCO,sBAAsB,CAACP,GAAD,EAAM,IAAN,CAAzD;AACA,SAAO;AACHQ,IAAAA,QAAQ,EAAE,IADP;AAEHC,IAAAA,IAAI,EAAE,WAFH;AAGHE,IAAAA,YAAY,EAAEV;AAHX,GAAP;AAKH,CAP0C,CAApC;AASA,MAAMY,OAAO,WAAPA,OAAO,GAAGrD,uBAAuB,CAAC,CAAC;AAAEC,EAAAA,aAAa,EAAE,CAACqD,OAAO,GAAG,EAAX,CAAjB;AAAiCf,EAAAA,MAAjC;AAAyCC,EAAAA,GAAzC;AAA8CC,EAAAA;AAA9C,CAAD,KAAgE;AAC3GI,EAAAA,MAAM,CAACC,cAAP,CAAsBP,MAAtB,EAA8BC,GAA9B,EAAmCO,sBAAsB,CAACP,GAAD,CAAzD;AACA,SAAO;AACHQ,IAAAA,QAAQ,EAAE,IADP;AAEHC,IAAAA,IAAI,EAAE,cAFH;AAGHM,IAAAA,QAAQ,EAAE,SAHP;AAIHD,IAAAA,OAJG;AAKHH,IAAAA,YAAY,EAAEV;AALX,GAAP;AAOH,CAT6C,CAAvC;AAWA,MAAMe,MAAM,WAANA,MAAM,GAAGxD,uBAAuB,CAAC,CAAC;AAAEC,EAAAA,aAAa,EAAE,CAACqD,OAAO,GAAG,EAAX,CAAjB;AAAiCf,EAAAA,MAAjC;AAAyCC,EAAAA,GAAzC;AAA8CC,EAAAA;AAA9C,CAAD,KAAgE;AAC1GI,EAAAA,MAAM,CAACC,cAAP,CAAsBP,MAAtB,EAA8BC,GAA9B,EAAmCO,sBAAsB,CAACP,GAAD,CAAzD;AACA,SAAO;AACHQ,IAAAA,QAAQ,EAAE,IADP;AAEHC,IAAAA,IAAI,EAAE,cAFH;AAGHM,IAAAA,QAAQ,EAAE,QAHP;AAIHD,IAAAA,OAJG;AAKHH,IAAAA,YAAY,EAAEV;AALX,GAAP;AAOH,CAT4C,CAAtC;AAWA,MAAMgB,SAAS,WAATA,SAAS,GAAGzD,uBAAuB,CAAC,CAAC;AAAEC,EAAAA,aAAa,EAAE,CAACqD,OAAO,GAAG,EAAX,CAAjB;AAAiCf,EAAAA,MAAjC;AAAyCC,EAAAA,GAAzC;AAA8CC,EAAAA;AAA9C,CAAD,KAAgE;AAC7G,MAAIiB,UAAU,GAAG,uBAAY,4BAAiBlB,GAAjB,CAAZ,CAAjB;AACA,0BAAaD,MAAb,EAAqBmB,UAArB,EAAiC;AAC7BT,IAAAA,IAAI,EAAE,WADuB;AAE7B/C,IAAAA,QAAQ,EAAE,MAFmB;AAG7B8C,IAAAA,QAAQ,EAAE;AAHmB,GAAjC;AAKAH,EAAAA,MAAM,CAACC,cAAP,CAAsBP,MAAtB,EAA8BC,GAA9B,EAAmCO,sBAAsB,CAACP,GAAD,CAAzD;AACAK,EAAAA,MAAM,CAACC,cAAP,CAAsBP,MAAtB,EAA8BmB,UAA9B,EAA0CX,sBAAsB,CAACW,UAAD,CAAhE;AACA,SAAO;AACHV,IAAAA,QAAQ,EAAE,IADP;AAEHC,IAAAA,IAAI,EAAE,cAFH;AAGHM,IAAAA,QAAQ,EAAE,WAHP;AAIHD,IAAAA,OAJG;AAKHH,IAAAA,YAAY,EAAEV;AALX,GAAP;AAOH,CAhB+C,CAAzC,C,CAkBP;AAEA;;AAEO,MAAMkB,MAAM,WAANA,MAAM,GAAGtB,eAAe,CAAC,CAAC;AAAEpC,EAAAA,aAAF;AAAiBwC,EAAAA;AAAjB,CAAD,MAAoC;AACtEmB,EAAAA,cAAc,EAAE,MAAM;AADgD,CAApC,CAAD,CAA9B;AAIA,MAAMC,QAAQ,WAARA,QAAQ,GAAGxB,eAAe,CAAC,CAAC;AAAEpC,EAAAA,aAAF;AAAiBwC,EAAAA;AAAjB,CAAD,MAAoC;AACxEqB,EAAAA,eAAe,EAAE,MAAM;AADiD,CAApC,CAAD,CAAhC;AAIA,MAAMC,YAAY,WAAZA,YAAY,GAAG1B,eAAe,CAAC,CAAC;AAAEpC,EAAAA,aAAF;AAAiBwC,EAAAA;AAAjB,CAAD,MAAoC;AAC5EmB,EAAAA,cAAc,EAAE3D,aAAa,CAAC,CAAD;AAD+C,CAApC,CAAD,CAApC;AAIA,MAAM+D,cAAc,WAAdA,cAAc,GAAG3B,eAAe,CAAC,CAAC;AAAEpC,EAAAA,aAAF;AAAiBwC,EAAAA;AAAjB,CAAD,MAAoC;AAC9EqB,EAAAA,eAAe,EAAE7D,aAAa,CAAC,CAAD;AADgD,CAApC,CAAD,CAAtC,C,CAMP;;AAGO,MAAMgE,MAAM,WAANA,MAAM,GAAG5B,eAAe,CAAC,CAAC;AAAEpC,EAAAA,aAAF;AAAiBwC,EAAAA;AAAjB,CAAD,MAAoC;AACtEO,EAAAA,QAAQ,EAAE;AAD4D,CAApC,CAAD,CAA9B;AAKA,MAAMkB,OAAO,WAAPA,OAAO,GAAG7B,eAAe,CAAC,CAAC;AAAEpC,EAAAA,aAAF;AAAiBwC,EAAAA;AAAjB,CAAD,MAAoC;AACvE0B,EAAAA,WAAW,EAAE;AAD0D,CAApC,CAAD,CAA/B,C,CAKP;;AAEO,MAAMC,QAAQ,WAARA,QAAQ,GAAG/B,eAAe,CAAC,CAAC;AAAEpC,EAAAA,aAAF;AAAiBsC,EAAAA,MAAjB;AAAyBC,EAAAA,GAAzB;AAA8BC,EAAAA;AAA9B,CAAD,KAAgD;AACpFxC,EAAAA,aAAa,CAACoE,OAAd,CAAsBC,SAAS,IAAI/B,MAAM,CAACgC,UAAP,CAAkBC,UAAlB,CAA6BhC,GAA7B,EAAkC8B,SAAlC,CAAnC;AACA,SAAO;AACHG,IAAAA,UAAU,EAAExE;AADT,GAAP;AAGH,CALsC,CAAhC;;AAOA,MAAMyE,OAAO,WAAPA,OAAO,GAAG,CAAC,GAAGC,MAAJ,KAAeC,SAAS,IAAI;AAE/CC,EAAAA,QAAQ,CAAEtC,MAAD,IAAY;AAEjB,QAAIuC,KAAK,GAAG,OAAOvC,MAAP,KAAkB,UAAlB,GAA+BA,MAA/B,GAAwCA,MAAM,CAACwC,WAA3D;AACA,QAAIC,SAAS,GAAG,OAAOzC,MAAP,KAAkB,UAAlB,GAA+BA,MAAM,CAACyC,SAAtC,GAAkDzC,MAAlE;AAGA,oBAAKoC,MAAL,EAAa,CAACnC,GAAD,EAAMyC,KAAN,KAAgB;AAGzB;AACA,sBAAKpC,MAAM,CAACqC,yBAAP,CAAiCD,KAAjC,CAAL,EAA8C,CAACzC,GAAD,EAAM2C,UAAN,KAAqB;AAC/D,YAAI3C,GAAG,IAAI,MAAP,IAAiBA,GAAG,IAAI,WAAxB,IAAuCA,GAAG,IAAI,QAAlD,EAA4D;AAC5D,YAAI4C,QAAQ,GAAG,uBAAYH,KAAZ,EAAmBzC,GAAnB,CAAf;AACA,YAAI,CAAC6C,OAAO,CAACD,QAAD,CAAZ,EAAwB,wBAAaN,KAAb,EAAoBtC,GAApB,EAAyB4C,QAAzB;AACxBvC,QAAAA,MAAM,CAACC,cAAP,CAAsBgC,KAAtB,EAA6BtC,GAA7B,EAAkC2C,UAAlC;AACH,OALD,EAJyB,CAWzB;;AACA,sBAAKtC,MAAM,CAACqC,yBAAP,CAAiCD,KAAK,CAACD,SAAvC,CAAL,EAAwD,CAACxC,GAAD,EAAM2C,UAAN,KAAqB;AACzE,YAAI3C,GAAG,KAAK,aAAR,IAAyBA,GAAG,KAAK,aAAjC,IAAkDA,GAAG,KAAK,gBAA9D,EAAgF;AAChF,YAAI4C,QAAQ,GAAG,uBAAY;AAAEE,UAAAA,SAAS,EAAE;AAAEP,YAAAA,WAAW,EAAEE;AAAf;AAAb,SAAZ,EAAmDzC,GAAnD,CAAf;AACA,YAAI,CAAC6C,OAAO,CAACD,QAAD,CAAZ,EAAwB,wBAAaJ,SAAb,EAAwBxC,GAAxB,EAA6B4C,QAA7B;AACxBvC,QAAAA,MAAM,CAACC,cAAP,CAAsBkC,SAAtB,EAAiCxC,GAAjC,EAAsC2C,UAAtC;AACH,OALD;;AAOA,UAAIF,KAAK,CAACD,SAAN,CAAgB,gBAAhB,CAAJ,EAAuC;AACnC,YAAIA,SAAS,CAAC,gBAAD,CAAb,EAAiCA,SAAS,CAAC,gBAAD,CAAT,CAA4BO,QAA5B,mCAA4CP,SAAS,CAAC,gBAAD,CAAT,CAA4BO,QAAxE,GAAqFN,KAAK,CAACD,SAAN,CAAgB,gBAAhB,EAAkCO,QAAvH,EAAjC,KACKP,SAAS,CAAC,gBAAD,CAAT,GAA8BC,KAAK,CAACD,SAAN,CAAgB,gBAAhB,CAA9B;AACR;AAEJ,KAxBD;AA0BH,GAhCO,CAAR,CAgCGJ,SAhCH;AAmCAY,EAAAA,UAAU,CAAEC,MAAD,IAAY;AACnB,oBAAKd,MAAL,EAAa,CAACnC,GAAD,EAAMyC,KAAN,KAAgB;AACzB,UAAIA,KAAK,CAACD,SAAN,CAAgBU,WAApB,EAAiCT,KAAK,CAACD,SAAN,CAAgBU,WAAhB,CAA4BC,IAA5B,CAAiCF,MAAjC;AACpC,KAFD;AAGH,GAJS,CAAV,CAIGb,SAJH;AAKH,CA1CM;;AA4CP,SAASgB,YAAT,CAAsBC,MAAtB,EAA8BC,WAAW,GAAG,KAA5C,EAAmD;AAC/C,QAAMC,OAAO,GAAG,UAAUC,IAAV,EAAgB,GAAGC,IAAnB,EAAyB;AACrC,QAAIH,WAAJ,EAAiBG,IAAI,CAACC,OAAL,CAAaF,IAAb;AACjB,WAAOH,MAAM,CAACF,IAAP,CAAY,IAAZ,EAAkB,GAAGM,IAArB,CAAP;AACH,GAHD;;AAIA,SAAO,UAAU,GAAGA,IAAb,EAAmB;AACtB,WAAO,IAAIE,UAAJ,CAAS,CAAC,IAAD,EAAOJ,OAAP,CAAT,EAA0B,GAAGE,IAA7B,CAAP;AACH,GAFD;AAGH;;AAEM,MAAMG,MAAM,WAANA,MAAM,GAAG,CAACxB,SAAD,EAAYkB,WAAW,GAAG,KAA1B,KAAoC;AACtD,MAAI,OAAOlB,SAAP,KAAqB,QAAzB,EAAmC;AAC/B,QAAIyB,QAAJ;AACAxB,IAAAA,QAAQ,CAAC,CAACtC,MAAD,EAASC,GAAT,KAAiB;AACtB,8BAAaD,MAAb,EAAqBC,GAArB,EAA0B;AACtB8D,QAAAA,QAAQ,EAAE,IADY;AAEtBR,QAAAA,WAFsB;AAGtBO,QAAAA;AAHsB,OAA1B;AAKH,KANO,CAAR,CAMGzB,SANH;AAOA2B,IAAAA,IAAI,CAACV,MAAM,IAAI;AACXQ,MAAAA,QAAQ,GAAGR,MAAX;AACA,aAAOD,YAAY,CAACC,MAAD,EAASC,WAAT,CAAnB;AACH,KAHG,CAAJ,CAGGlB,SAHH;AAIA,WAAOA,SAAP;AACH;;AACD,MAAI,OAAOA,SAAP,KAAqB,UAAzB,EAAqC;AACjC,WAAOgB,YAAY,CAAChB,SAAD,EAAYkB,WAAZ,CAAnB;AACH;;AACD,MAAI,OAAOlB,SAAP,KAAqB,SAAzB,EAAoC;AAChC,WAAO4B,CAAC,IAAIJ,MAAM,CAACI,CAAD,EAAI5B,SAAJ,CAAlB;AACH;AACJ,CAtBM,C,CAwBP;;;AAGA,SAAS5E,uBAAT,CAAiCyG,MAAjC,EAAyC;AAErC,QAAMC,SAAS,GAAG,UAAU9B,SAAV,EAAqB3E,aAAa,GAAG,EAArC,EAAyC;AACvD2E,IAAAA,SAAS,GAAGC,QAAQ,CAAC,CAACtC,MAAD,EAASC,GAAT,EAAcC,UAAd,KAA6B;AAC9C,8BAAaF,MAAb,EAAqBC,GAArB;AACIQ,QAAAA,QAAQ,EAAE,IADd;AAEIC,QAAAA,IAAI,EAAE,WAFV;AAGIE,QAAAA,YAAY,EAAEV;AAHlB,SAIOgE,MAAM,CAAC;AAAExG,QAAAA,aAAF;AAAiBsC,QAAAA,MAAjB;AAAyBC,QAAAA,GAAzB;AAA8BC,QAAAA;AAA9B,OAAD,CAJb;AAMH,KAPmB,CAAR,CAOTmC,SAPS,CAAZ;AAQA,WAAOA,SAAS,CAAC+B,WAAjB;AACA,WAAO/B,SAAS,CAACO,UAAV,CAAqBxE,KAA5B;AACA,WAAOiE,SAAS,CAACO,UAAV,CAAqByB,QAA5B;AACA,2CACOhC,SADP;AAEIiC,MAAAA,IAAI,EAAE,QAFV;AAGIC,MAAAA,SAAS,EAAE,WAHf;AAII3B,MAAAA,UAAU,kCACHP,SAAS,CAACO,UADP,GAEHpC,sBAAsB,CAAC6B,SAAS,CAACpC,GAAX,CAFnB;AAJd,OAZuD,CAoBrD;AACL,GArBD;;AAuBA,SAAO,UAAU,GAAGyD,IAAb,EAAmB;AACtB,QAAIA,IAAI,CAAC,CAAD,CAAJ,IAAWA,IAAI,CAAC,CAAD,CAAJ,CAAQd,UAAnB,IAAiCc,IAAI,CAAC,CAAD,CAAJ,CAAQY,IAA7C,EAAmD,OAAOH,SAAS,CAACT,IAAI,CAAC,CAAD,CAAL,CAAhB;AACnD,WAAOrB,SAAS,IAAI8B,SAAS,CAAC9B,SAAD,EAAYqB,IAAZ,CAA7B;AACH,GAHD;AAIH;;AAED,SAAS5D,eAAT,CAAyBoE,MAAzB,EAAiC;AAE7B,QAAMC,SAAS,GAAG,UAAU9B,SAAV,EAAqB3E,aAAa,GAAG,EAArC,EAAyC;AACvD2E,IAAAA,SAAS,GAAGC,QAAQ,CAAC,CAACtC,MAAD,EAASC,GAAT,EAAcC,UAAd,EAA0BsE,QAA1B,KACjB,wBAAaxE,MAAb,EAAqBC,GAArB,oBACOiE,MAAM,CAAC;AAAExG,MAAAA,aAAF;AAAiBsC,MAAAA,MAAjB;AAAyBC,MAAAA,GAAzB;AAA8BC,MAAAA,UAA9B;AAA0CsE,MAAAA;AAA1C,KAAD,CADb,EADgB,CAAR,CAIVnC,SAJU,CAAZ,CADuD,CAMvD;AACA;AACA;;AAEA,QAAGA,SAAS,CAACiC,IAAV,IAAkB,OAAlB,IAA6BjC,SAAS,CAAC+B,WAAV,KAA0BK,SAA1D,EAAoE;AAChEpC,MAAAA,SAAS,CAAC+B,WAAV,GAAwB,YAAW;AAC/B,eAAO,KAAK/B,SAAS,CAACpC,GAAf,CAAP;AACH,OAFD;AAGH;;AAED,WAAOoC,SAAP;AACH,GAjBD;;AAmBA,SAAO,UAAU,GAAGqB,IAAb,EAAmB;AACtB,QAAIA,IAAI,CAAC,CAAD,CAAJ,IAAWA,IAAI,CAAC,CAAD,CAAJ,CAAQd,UAAnB,IAAiCc,IAAI,CAAC,CAAD,CAAJ,CAAQY,IAA7C,EAAmD,OAAOH,SAAS,CAACT,IAAI,CAAC,CAAD,CAAL,CAAhB;AACnD,WAAOrB,SAAS,IAAI8B,SAAS,CAAC9B,SAAD,EAAYqB,IAAZ,CAA7B;AACH,GAHD;AAIH;;AAED,SAASlD,sBAAT,CAAgCP,GAAhC,EAAqCY,IAAI,GAAG,KAA5C,EAAmD;AAC/C,SAAO;AACH6D,IAAAA,UAAU,EAAE,IADT;AAEHC,IAAAA,GAAG,EAAE,IAAIC,QAAJ,CAAc;qEAC0C3E,GAAI,oDAAmDA,GAAI;4CACpFA,GAAI;SAFnC,CAFF;AAMH4E,IAAAA,GAAG,EAAE,IAAID,QAAJ,CAAa,OAAb,EAAuB;qCACC3E,GAAI;;kBAEvBY,IAAI,GAAG,oBAAH,GAAyB,EAAG;;0BAExBZ,GAAI;;;;;SALjB;AANF,GAAP;AAkBH;;AAED,SAASqC,QAAT,CAAkBwC,QAAlB,EAA4B;AACxB,SAAO,UAAUzC,SAAV,EAAqB;AACxB,QAAI0C,QAAQ,GAAG1C,SAAS,CAAC2C,QAAzB;AACA,QAAI;AAAEZ,MAAAA;AAAF,QAAkB/B,SAAtB;;AACAA,IAAAA,SAAS,CAAC2C,QAAV,GAAqBzC,KAAK,IAAI;AAAA;;AAC1B,UAAI,OAAOwC,QAAP,IAAmB,UAAvB,EAAmCA,QAAQ,CAACxC,KAAD,CAAR;AACnC,UAAInE,KAAJ;;AACA,cAAQiE,SAAS,CAACkC,SAAlB;AACI,aAAK,OAAL;AACIO,UAAAA,QAAQ,CAACvC,KAAD,CAAR;AACA;;AACJ,aAAK,QAAL;AACInE,UAAAA,KAAK,GAAGiE,SAAS,CAACiC,IAAV,KAAmB,OAAnB,IAA8B,OAAOF,WAAP,KAAuB,UAArD,GAAkEA,WAAW,EAA7E,4BAAkF/B,SAAS,CAACO,UAA5F,0DAAkF,sBAAsBxE,KAAhH;AACA0G,UAAAA,QAAQ,CAACvC,KAAD,EAAQF,SAAS,CAACpC,GAAlB,EAAuB7B,KAAvB,CAAR;AACA;;AACJ;AACIA,UAAAA,KAAK,GAAGiE,SAAS,CAACiC,IAAV,KAAmB,OAAnB,IAA8B,OAAOF,WAAP,KAAuB,UAArD,GAAkEA,WAAW,EAA7E,6BAAkF/B,SAAS,CAACO,UAA5F,2DAAkF,uBAAsBxE,KAAhH;AACA0G,UAAAA,QAAQ,CAACvC,KAAK,CAACE,SAAP,EAAkBJ,SAAS,CAACpC,GAA5B,EAAiC7B,KAAjC,EAAwCiE,SAAS,CAACiC,IAAV,KAAmB,QAA3D,CAAR;AAVR;AAaH,KAhBD;;AAiBA,WAAOjC,SAAP;AACH,GArBD;AAsBH;;AAED,SAAS2B,IAAT,CAAcc,QAAd,EAAwB;AACpB,SAAO,UAAUzC,SAAV,EAAqB;AACxB,QAAIyB,QAAJ;;AACA,YAAQzB,SAAS,CAACiC,IAAlB;AACI,WAAK,OAAL;AACIR,QAAAA,QAAQ,GAAG,OAAOzB,SAAS,CAAC+B,WAAjB,KAAiC,UAAjC,GAA8C/B,SAAS,CAAC+B,WAAxD,GAAsE,MAAM,IAAvF;;AACA/B,QAAAA,SAAS,CAAC+B,WAAV,GAAwB,MAAM,UAAU,GAAGV,IAAb,EAAmB;AAC7CoB,UAAAA,QAAQ,CAAC,MAAMhB,QAAQ,CAAC,GAAGJ,IAAJ,CAAf,CAAR;AACH,SAFD;;AAGA;;AACJ,WAAK,QAAL;AACII,QAAAA,QAAQ,GAAGzB,SAAS,CAACO,UAAV,CAAqBxE,KAAhC;AACAiE,QAAAA,SAAS,CAACO,UAAV,CAAqBxE,KAArB,GAA6B0G,QAAQ,CAAChB,QAAD,CAArC;AACA;AAVR;;AAYA,WAAOzB,SAAP;AACH,GAfD;AAgBH;;AAED,SAASY,UAAT,CAAoB6B,QAApB,EAA8B;AAC1B,SAAO,UAAUzC,SAAV,EAAqB;AACxB,QAAIxB,IAAI,GAAGoE,MAAM,EAAjB;AACA5C,IAAAA,SAAS,CAAC6C,MAAV,GAAmB,CAAC;AAChBZ,MAAAA,IAAI,EAAE,OADU;AAEhBC,MAAAA,SAAS,EAAE,KAFK;AAGhBtE,MAAAA,GAAG,EAAEY,IAHW;AAIhB+B,MAAAA,UAAU,EAAE,EAJI;;AAKhBwB,MAAAA,WAAW,GAAG;AACV,eAAO,KAAKvD,IAAL,CAAP,CADU,CAEV;;AACAiE,QAAAA,QAAQ,CAAC,IAAD,CAAR;AACH;;AATe,KAAD,CAAnB;AAWH,GAbD;AAcH;;AAED,MAAMhC,OAAO,GAAGmB,CAAC,IAAI3D,MAAM,CAAC6E,IAAP,CAAYlB,CAAZ,EAAemB,MAAf,KAA0B,CAA/C","sourcesContent":["import { saveMetadata, getMetadata, toForeignKeyName, each, metadata, index, toCamelCase, Pipe, DateTime } from '@triframe/core'\r\n\r\n\r\n//  ---------------------- DATATYPES ----------------------\r\n\r\nexport const string = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'varchar',\r\n    constraints: decoratorArgs[1] || {}\r\n}))\r\n\r\nexport const text = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'text',\r\n    constraints: decoratorArgs[1] || {}\r\n}))\r\n\r\nexport const numeric = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'numeric',\r\n    constraints: decoratorArgs[1] || {}\r\n}))\r\n\r\nexport const float = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'float8',\r\n    constraints: decoratorArgs[1] || {}\r\n}))\r\n\r\nexport const integer = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'int4',\r\n    constraints: decoratorArgs[1] || {}\r\n}))\r\n\r\nexport const boolean = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'bool',\r\n    constraints: decoratorArgs[1] || {}\r\n}))\r\n\r\nexport const timestamp = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'timestamptz',\r\n    constraints: decoratorArgs[1] || {},\r\n    sqlEncode: value => value instanceof DateTime ? value.toJSDate() : value,\r\n    sqlDecode: value => value instanceof Date ? DateTime.fromJSDate(value) : DateTime.fromISO(value)\r\n}))\r\n\r\nexport const timestamptz = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'timestamptz',\r\n    constraints: decoratorArgs[1] || {}\r\n}))\r\n\r\nexport const date = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'date',\r\n    constraints: decoratorArgs[1] || {}\r\n}))\r\n\r\nexport const time = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'time',\r\n    constraints: decoratorArgs[1] || {}\r\n}))\r\n\r\nexport const point = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'point',\r\n    constraints: decoratorArgs[1] || {}\r\n}))\r\n\r\nexport const line = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'line',\r\n    constraints: decoratorArgs[1] || {}\r\n}))\r\n\r\nexport const lseg = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'lseg',\r\n    constraints: decoratorArgs[1] || {}\r\n}))\r\n\r\nexport const path = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'path',\r\n    constraints: decoratorArgs[1] || {}\r\n}))\r\n\r\nexport const polygon = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'polygon',\r\n    constraints: decoratorArgs[1] || {}\r\n}))\r\n\r\nexport const circle = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'circle',\r\n    constraints: decoratorArgs[1] || {}\r\n}))\r\n\r\nexport const list = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'json',\r\n    constraints: decoratorArgs[1] || {},\r\n    sqlEncode: value => JSON.stringify(value),\r\n    sqlDecode: value => {\r\n        try {\r\n            return JSON.parse(value)\r\n        } catch (err) {\r\n            return value;\r\n        }\r\n    }\r\n}))\r\n\r\nexport const json = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'json',\r\n    constraints: decoratorArgs[1] || {},\r\n    sqlEncode: value => JSON.stringify(value),\r\n    sqlDecode: value => {\r\n        try {\r\n            return JSON.parse(value)\r\n        } catch (err) {\r\n            return value;\r\n        }\r\n    }\r\n}))\r\n\r\nexport const serial = createPropertyDecorator(({ decoratorArgs }) => ({\r\n    datatype: 'SERIAL',\r\n    constraints: decoratorArgs[0] || {}\r\n}))\r\n\r\nexport const pk = serial({ primaryKey: true })\r\n\r\nexport const derive = createDecorator(({ decoratorArgs: [opts], target, key, fieldValue }) => {\r\n    if (!opts.sql && !opts.code) throw Error(`Must provide either 'sql' or 'code' option when defining derived field (${key})`)\r\n    Object.defineProperty(target, key, createDocumentProperty(key))\r\n    return {\r\n        isShared: true,\r\n        type: opts.sql ? 'sql-derived' : 'code-derived',\r\n        definition: opts.sql || opts.code,\r\n        defaultValue: fieldValue\r\n    }\r\n})\r\n\r\nexport const temp = createPropertyDecorator(({ decoratorArgs: [opts], target, key, fieldValue }) => {\r\n    Object.defineProperty(target, key, createDocumentProperty(key, true))\r\n    return {\r\n        isShared: true,\r\n        type: 'temporary',\r\n        defaultValue: fieldValue\r\n    }\r\n})\r\n\r\nexport const hasMany = createPropertyDecorator(({ decoratorArgs: [options = {}], target, key, fieldValue }) => {\r\n    Object.defineProperty(target, key, createDocumentProperty(key))\r\n    return {\r\n        isShared: true,\r\n        type: 'relationship',\r\n        joinType: 'hasMany',\r\n        options,\r\n        defaultValue: fieldValue\r\n    }\r\n})\r\n\r\nexport const hasOne = createPropertyDecorator(({ decoratorArgs: [options = {}], target, key, fieldValue }) => {\r\n    Object.defineProperty(target, key, createDocumentProperty(key))\r\n    return {\r\n        isShared: true,\r\n        type: 'relationship',\r\n        joinType: 'hasOne',\r\n        options,\r\n        defaultValue: fieldValue\r\n    }\r\n})\r\n\r\nexport const belongsTo = createPropertyDecorator(({ decoratorArgs: [options = {}], target, key, fieldValue }) => {\r\n    let foreignKey = toCamelCase(toForeignKeyName(key))\r\n    saveMetadata(target, foreignKey, {\r\n        type: 'persisted',\r\n        datatype: 'int4',\r\n        isShared: true\r\n    })\r\n    Object.defineProperty(target, key, createDocumentProperty(key))\r\n    Object.defineProperty(target, foreignKey, createDocumentProperty(foreignKey))\r\n    return {\r\n        isShared: true,\r\n        type: 'relationship',\r\n        joinType: 'belongsTo',\r\n        options,\r\n        defaultValue: fieldValue\r\n    }\r\n})\r\n\r\n//  --------------------- ACCESS LEVELS --------------------\r\n\r\n// arbiter?\r\n\r\nexport const hidden = createDecorator(({ decoratorArgs, fieldValue }) => ({\r\n    readAccessTest: () => false\r\n}))\r\n\r\nexport const readonly = createDecorator(({ decoratorArgs, fieldValue }) => ({\r\n    writeAccessTest: () => false\r\n}))\r\n\r\nexport const hiddenUnless = createDecorator(({ decoratorArgs, fieldValue }) => ({\r\n    readAccessTest: decoratorArgs[0]\r\n}))\r\n\r\nexport const readonlyUnless = createDecorator(({ decoratorArgs, fieldValue }) => ({\r\n    writeAccessTest: decoratorArgs[0]\r\n}))\r\n\r\n\r\n\r\n//  ---------------------- MISC ----------------------\r\n\r\n\r\nexport const shared = createDecorator(({ decoratorArgs, fieldValue }) => ({\r\n    isShared: true\r\n}))\r\n\r\n\r\nexport const session = createDecorator(({ decoratorArgs, fieldValue }) => ({\r\n    usesSession: true\r\n}))\r\n\r\n\r\n// core?\r\n\r\nexport const validate = createDecorator(({ decoratorArgs, target, key, fieldValue }) => {\r\n    decoratorArgs.forEach(validator => target.validation.addHandler(key, validator))\r\n    return {\r\n        validators: decoratorArgs\r\n    }\r\n})\r\n\r\nexport const include = (...models) => decorated => {\r\n\r\n    register((target) => {\r\n\r\n        let Class = typeof target === 'function' ? target : target.constructor\r\n        let prototype = typeof target === 'function' ? target.prototype : target\r\n\r\n\r\n        each(models, (key, Model) => {\r\n\r\n\r\n            // Copy Static\r\n            each(Object.getOwnPropertyDescriptors(Model), (key, descriptor) => {\r\n                if (key == 'name' || key == 'prototype' || key == 'length') return\r\n                let metadata = getMetadata(Model, key)\r\n                if (!isEmpty(metadata)) saveMetadata(Class, key, metadata)\r\n                Object.defineProperty(Class, key, descriptor)\r\n            })\r\n\r\n            // Copy Prototype\r\n            each(Object.getOwnPropertyDescriptors(Model.prototype), (key, descriptor) => {\r\n                if (key === 'constructor' || key === 'onConstruct' || key === '[[validation]]') return\r\n                let metadata = getMetadata({ __proto__: { constructor: Model } }, key)\r\n                if (!isEmpty(metadata)) saveMetadata(prototype, key, metadata)\r\n                Object.defineProperty(prototype, key, descriptor)\r\n            })\r\n\r\n            if (Model.prototype['[[validation]]']) {\r\n                if (prototype['[[validation]]']) prototype['[[validation]]'].handlers = { ...prototype['[[validation]]'].handlers, ...Model.prototype['[[validation]]'].handlers }\r\n                else prototype['[[validation]]'] = Model.prototype['[[validation]]']\r\n            }\r\n\r\n        })\r\n\r\n    })(decorated)\r\n\r\n\r\n    initialize((object) => {\r\n        each(models, (key, Model) => {\r\n            if (Model.prototype.onConstruct) Model.prototype.onConstruct.call(object)\r\n        })\r\n    })(decorated)\r\n}\r\n\r\nfunction createStream(method, prependEmit = false) {\r\n    const process = function (emit, ...args) {\r\n        if (prependEmit) args.unshift(emit)\r\n        return method.call(this, ...args)\r\n    }\r\n    return function (...args) {\r\n        return new Pipe([this, process], ...args)\r\n    }\r\n}\r\n\r\nexport const stream = (decorated, prependEmit = false) => {\r\n    if (typeof decorated === 'object') {\r\n        let original;\r\n        register((target, key) => {\r\n            saveMetadata(target, key, {\r\n                isStream: true,\r\n                prependEmit,\r\n                original\r\n            })\r\n        })(decorated)\r\n        wrap(method => {\r\n            original = method\r\n            return createStream(method, prependEmit)\r\n        })(decorated)\r\n        return decorated\r\n    }\r\n    if (typeof decorated === 'function') {\r\n        return createStream(decorated, prependEmit)\r\n    }\r\n    if (typeof decorated === 'boolean') {\r\n        return x => stream(x, decorated)\r\n    }\r\n}\r\n\r\n// TODO: VALIDATION DECORATOR\r\n\r\n\r\nfunction createPropertyDecorator(define) {\r\n\r\n    const decorator = function (decorated, decoratorArgs = []) {\r\n        decorated = register((target, key, fieldValue) => {\r\n            saveMetadata(target, key, {\r\n                isShared: true,\r\n                type: 'persisted',\r\n                defaultValue: fieldValue,\r\n                ...define({ decoratorArgs, target, key, fieldValue })\r\n            })\r\n        })(decorated)\r\n        delete decorated.initializer\r\n        delete decorated.descriptor.value\r\n        delete decorated.descriptor.writable\r\n        return {\r\n            ...decorated,\r\n            kind: 'method',\r\n            placement: 'prototype',\r\n            descriptor: {\r\n                ...decorated.descriptor,\r\n                ...createDocumentProperty(decorated.key)\r\n            }\r\n        } // initialize((target, key, value) => { })(decorated)\r\n    }\r\n\r\n    return function (...args) {\r\n        if (args[0] && args[0].descriptor && args[0].kind) return decorator(args[0])\r\n        return decorated => decorator(decorated, args)\r\n    }\r\n}\r\n\r\nfunction createDecorator(define) {\r\n\r\n    const decorator = function (decorated, decoratorArgs = []) {\r\n        decorated = register((target, key, fieldValue, isMethod) =>\r\n            saveMetadata(target, key, {\r\n                ...define({ decoratorArgs, target, key, fieldValue, isMethod })\r\n            })\r\n        )(decorated)\r\n        // delete decorated.initializer\r\n        // delete decorated.descriptor.value\r\n        // delete decorated.descriptor.writable\r\n\r\n        if(decorated.kind == 'field' && decorated.initializer === undefined){\r\n            decorated.initializer = function() {\r\n                return this[decorated.key]\r\n            }\r\n        }\r\n\r\n        return decorated\r\n    }\r\n\r\n    return function (...args) {\r\n        if (args[0] && args[0].descriptor && args[0].kind) return decorator(args[0])\r\n        return decorated => decorator(decorated, args)\r\n    }\r\n}\r\n\r\nfunction createDocumentProperty(key, temp = false) {\r\n    return {\r\n        enumerable: true,\r\n        get: new Function(`\r\n            if(this['[[attributes]]'].id && this['[[attributes]]'].${key} === undefined) throw Error('Tried to reference \"${key}\", which was not included when resource was queried, or has not been defined yet')\r\n            return this['[[attributes]]'].${key}\r\n        `),\r\n        set: new Function('value', `\r\n            this['[[attributes]]'].${key} = value\r\n            let patch = {\r\n                ${temp ? 'isTemporary: true,': ''}\r\n                op: 'replace',\r\n                path: '/${key}',\r\n                value\r\n            }\r\n            this['[[patches]]'].push(patch)\r\n            this.emit('Δ.change', [ patch ])\r\n        `)\r\n    }\r\n}\r\n\r\nfunction register(callback) {\r\n    return function (decorated) {\r\n        let previous = decorated.finisher\r\n        let { initializer } = decorated\r\n        decorated.finisher = Class => {\r\n            if (typeof previous == 'function') previous(Class)\r\n            let value;\r\n            switch (decorated.placement) {\r\n                case 'class':\r\n                    callback(Class)\r\n                    break;\r\n                case 'static':\r\n                    value = decorated.kind === 'field' && typeof initializer === 'function' ? initializer() : decorated.descriptor?.value\r\n                    callback(Class, decorated.key, value)\r\n                    break;\r\n                default:\r\n                    value = decorated.kind === 'field' && typeof initializer === 'function' ? initializer() : decorated.descriptor?.value\r\n                    callback(Class.prototype, decorated.key, value, decorated.kind === 'method')\r\n\r\n            }\r\n        }\r\n        return decorated\r\n    }\r\n}\r\n\r\nfunction wrap(callback) {\r\n    return function (decorated) {\r\n        let original;\r\n        switch (decorated.kind) {\r\n            case 'field':\r\n                original = typeof decorated.initializer === 'function' ? decorated.initializer : () => null\r\n                decorated.initializer = () => function (...args) {\r\n                    callback(() => original(...args))\r\n                }\r\n                break;\r\n            case 'method':\r\n                original = decorated.descriptor.value\r\n                decorated.descriptor.value = callback(original)\r\n                break;\r\n        }\r\n        return decorated\r\n    }\r\n}\r\n\r\nfunction initialize(callback) {\r\n    return function (decorated) {\r\n        let temp = Symbol()\r\n        decorated.extras = [{\r\n            kind: 'field',\r\n            placement: 'own',\r\n            key: temp,\r\n            descriptor: {},\r\n            initializer() {\r\n                delete this[temp]\r\n                // let value = typeof decorated.initializer === 'function' ? decorated.initializer() : undefined\r\n                callback(this)\r\n            }\r\n        }]\r\n    }\r\n}\r\n\r\nconst isEmpty = x => Object.keys(x).length === 0"],"file":"decorators.js"}