var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.FileInput=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));var _react=_interopRequireWildcard(require("react"));var _Button=require("../Button");var _paper=require("../paper");var _Provider=require("../Provider");var ImagePicker=_interopRequireWildcard(require("expo-image-picker"));var _this=this,_jsxFileName="C:\\Users\\Joshua\\My Documents\\development\\triframe\\packages\\designer\\src\\FileInput\\index.native.js";var FileInput=function FileInput(_ref){var _ref$onChange=_ref.onChange,onChange=_ref$onChange===void 0?function(){return void 0;}:_ref$onChange,_ref$multiple=_ref.multiple,multiple=_ref$multiple===void 0?false:_ref$multiple,_ref$path=_ref.path,path=_ref$path===void 0?false:_ref$path,_ref$children=_ref.children,children=_ref$children===void 0?'Upload':_ref$children,props=(0,_objectWithoutProperties2.default)(_ref,["onChange","multiple","path","children"]);var _useState=(0,_react.useState)(''),_useState2=(0,_slicedToArray2.default)(_useState,2),filenames=_useState2[0],changeFilenames=_useState2[1];var openImagePickerAsync=function openImagePickerAsync(url){var permissionResult,result,localUri,filename,match,type,formData;return _regenerator.default.async(function openImagePickerAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regenerator.default.awrap(ImagePicker.requestCameraRollPermissionsAsync());case 2:permissionResult=_context.sent;if(!(permissionResult.granted===false)){_context.next=6;break;}alert("Permission to access camera roll is required!");return _context.abrupt("return");case 6:_context.next=8;return _regenerator.default.awrap(ImagePicker.launchImageLibraryAsync({base64:false}));case 8:result=_context.sent;if(!result.cancelled){localUri=result.uri;filename=localUri.split('/').pop();changeFilenames(filename);match=/\.(\w+)$/.exec(filename);type=match?"image/"+match[1]:"image";formData=new FormData();formData.append(0,{uri:localUri,name:filename,type:type});fetch(url+"/upload",{method:'POST',credentials:'include',headers:{'Content-Type':'multipart/form-data'},body:formData}).then(function(res){return res.json();}).then(function(urls){onChange(multiple?urls:urls[0]);});}case 10:case"end":return _context.stop();}}},null,null,null,Promise);};return _react.default.createElement(_Provider.Model.Consumer,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:54,columnNumber:7}},function(models){return _react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_Button.Button,(0,_extends2.default)({onPress:function onPress(){return openImagePickerAsync(models.url);}},props,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:57,columnNumber:13}}),children),_react.default.createElement(_paper.HelperText,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:58,columnNumber:13}},filenames));});};exports.FileInput=FileInput;
//# sourceMappingURL=index.native.js.map