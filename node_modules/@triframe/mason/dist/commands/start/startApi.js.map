{"version":3,"sources":["../../../src/commands/start/startApi.js"],"names":["chokidar","require","path","babel","fs","os","fork","execSync","debounce","isString","isArray","isRegExp","RESTART_COMMAND","DEBOUNCE_DURATION","startApi","program","watch","args","regexify","val","RegExp","join","TypeError","arrayify","split","cwd","process","only","ignore","transpileExtensions","DEFAULT_EXTENSIONS","extensions","concat","mainModule","console","error","exit","startsWith","childApp","pipeFd","pipeFilename","cache","errors","watcher","persistent","ignored","exclude","ignoreInitial","usePolling","watcherInitialized","length","on","close","killApp","debouncedHandleChange","handleChange","restartApp","stdin","setEncoding","data","String","trim","file","absoluteFile","generateTempFilename","now","Date","tmpdir","getYear","getMonth","getDate","pid","Math","random","toString","handleFileLoad","filename","callback","cached","stats","statSync","mtime","getTime","code","map","shouldIgnore","compile","err","result","stack","currentPipeFd","currentPipeFilename","hasRestarted","restartOnce","closeSync","unlinkSync","undefined","restartAppInternal","isRunning","kill","e","prepareRestart","restartMessage","message","log","Object","keys","platform","runnerExecArgv","execArgv","slice","debug","push","debugBrk","inspect","inspectArg","inspectBrk","inspectBrkArg","app","resolve","__dirname","event","disableAutowatch","relativeFilename","relative","add","source","sourceMap","sourceBuf","Buffer","from","alloc","mapBuf","JSON","stringify","lenBuf","writeUInt32BE","writeSync","send","pipe","handleUncaughtExceptions","disableExHandler","openSync","indexOf","extname","sep","util","optsManager","OptionManager","opts","init","babelrc","sourceMaps","ast","presets","plugins","transformFile"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nconst chokidar = require('chokidar');\r\nconst path = require('path');\r\nconst babel = require('@babel/core');\r\nconst fs = require('fs');\r\nconst os = require('os');\r\nconst fork = require('child_process').fork;\r\nconst execSync = require('child_process').execSync;\r\nconst debounce = require('lodash.debounce');\r\nconst isString = require('lodash.isstring');\r\nconst isArray = require('lodash.isarray');\r\nconst isRegExp = require('lodash.isregexp');\r\n\r\nconst RESTART_COMMAND = 'rs';\r\nconst DEBOUNCE_DURATION = 100; //milliseconds\r\n\r\nexport const startApi =  () => {\r\n\r\n  const program = {\r\n    watch: './src',\r\n    args: [ './src/Api.js' ]\r\n  }\r\n\r\n  // Plucked directly from old Babel Core\r\n  // https://github.com/babel/babel/commit/0df0c696a93889f029982bf36d34346a039b1920\r\n  function regexify(val) {\r\n    if (!val) return new RegExp;\r\n    if (isArray(val)) val = val.join(\"|\");\r\n    if (isString(val)) return new RegExp(val || \"\");\r\n    if (isRegExp(val)) return val;\r\n    throw new TypeError(\"illegal type for regexify\");\r\n  };\r\n\r\n  function arrayify(val) {\r\n    if (!val) return [];\r\n    if (isString(val)) return (val ? val.split(',') : []);\r\n    if (isArray(val)) return val;\r\n    throw new TypeError(\"illegal type for arrayify\");\r\n  };  \r\n\r\n  const cwd = process.cwd();\r\n\r\n  let only, ignore;\r\n\r\n\r\n  if (program.only != null) only = arrayify(program.only, regexify);\r\n  if (program.ignore != null) ignore = arrayify(program.ignore, regexify);\r\n\r\n  let transpileExtensions = babel.DEFAULT_EXTENSIONS;\r\n\r\n  if (program.extensions) {\r\n    transpileExtensions = transpileExtensions.concat(arrayify(program.extensions));\r\n  }\r\n\r\n  const mainModule = program.args[0] || 'index.js';\r\n  if (!mainModule) {\r\n    console.error('Main script not specified');\r\n    process.exit(1);\r\n  }\r\n  if (!mainModule.startsWith('.') && !mainModule.startsWith('/')) {\r\n    program.args[0] = path.join(cwd, mainModule);\r\n  }\r\n\r\n  let childApp, pipeFd, pipeFilename;\r\n\r\n  const cache = {};\r\n  const errors = {};\r\n\r\n  const watcher = chokidar.watch(program.watch, {\r\n    persistent: true,\r\n    ignored: program.exclude,\r\n    ignoreInitial: true,\r\n    usePolling: program.usePolling,\r\n  });\r\n  let watcherInitialized = (program.watch.length === 0);\r\n\r\n  process.on('SIGINT', function () {\r\n    watcher.close();\r\n    killApp();\r\n    process.exit(0);\r\n  });\r\n\r\n  const debouncedHandleChange = debounce(handleChange, DEBOUNCE_DURATION);\r\n\r\n  watcher.on('change', debouncedHandleChange);\r\n  watcher.on('add', debouncedHandleChange);\r\n  watcher.on('unlink', debouncedHandleChange);\r\n\r\n  watcher.on('ready', () => {\r\n    if (!watcherInitialized) {\r\n      watcherInitialized = true;\r\n      restartApp();\r\n    }\r\n  });\r\n\r\n  watcher.on('error', error => {\r\n    console.error('Watcher failure', error);\r\n    process.exit(1);\r\n  });\r\n\r\n  // Restart the app when a sequence of keys has been pressed ('rs' by refault)\r\n  const stdin = process.stdin;\r\n  stdin.setEncoding('utf8');\r\n  stdin.on('data', (data) => {\r\n    if (String(data).trim() === RESTART_COMMAND) {\r\n      restartApp();\r\n    }\r\n  });\r\n\r\n  function handleChange(file) {\r\n    const absoluteFile = file.startsWith('/') ? file : path.join(cwd, file);\r\n    delete cache[absoluteFile];\r\n    delete errors[absoluteFile];\r\n\r\n    // file is in use by the app, let's restart!\r\n    restartApp();\r\n  }\r\n\r\n  function generateTempFilename() {\r\n    const now = new Date();\r\n    return path.join(os.tmpdir(), [\r\n      now.getYear(), now.getMonth(), now.getDate(),\r\n      '-',\r\n      process.pid,\r\n      '-',\r\n      (Math.random() * 0x100000000 + 1).toString(36),\r\n    ].join(''));\r\n  }\r\n\r\n  function handleFileLoad(filename, callback) {\r\n    const cached = cache[filename];\r\n    if (cached) {\r\n      const stats = fs.statSync(filename);\r\n      if (stats.mtime.getTime() === cached.mtime) {\r\n        callback(cache[filename].code, cache[filename].map);\r\n        return;\r\n      }\r\n    }\r\n    if (!shouldIgnore(filename)) {\r\n      compile(filename, (err, result) => {\r\n        if (err) {\r\n          console.error('Babel compilation error', err.stack);\r\n          errors[filename] = true;\r\n          return;\r\n        }\r\n        const stats = fs.statSync(filename);\r\n        cache[filename] = {\r\n          code: result.code,\r\n          map: result.map,\r\n          mtime: stats.mtime.getTime(),\r\n        };\r\n        delete errors[filename];\r\n        callback(result.code, result.map);\r\n      });\r\n    } else {\r\n      callback();\r\n    }\r\n  }\r\n\r\n  function killApp() {\r\n    if (childApp) {\r\n      const currentPipeFd = pipeFd;\r\n      const currentPipeFilename = pipeFilename;\r\n\r\n      let hasRestarted = false;\r\n      const restartOnce = () => {\r\n        if (hasRestarted) return;\r\n        hasRestarted = true;\r\n        if (currentPipeFd) {\r\n          fs.closeSync(currentPipeFd); // silently close pipe fd\r\n        }\r\n        if (pipeFilename) {\r\n          fs.unlinkSync(pipeFilename); // silently remove old pipe file\r\n        }\r\n        pipeFd = undefined;\r\n        childApp = undefined;\r\n        pipeFilename = undefined;\r\n        restartAppInternal();\r\n      };\r\n      childApp.on('exit', restartOnce);\r\n      let isRunning = true;\r\n      try {\r\n        process.kill(childApp.pid, 0);\r\n      } catch (e) {\r\n        isRunning = false;\r\n      }\r\n      if (isRunning) {\r\n        try {\r\n          childApp.kill('SIGHUP');\r\n        } catch (error) {\r\n          childApp.kill('SIGKILL');\r\n        }\r\n        pipeFd = undefined;\r\n        pipeFilename = undefined;\r\n        childApp = undefined;\r\n      } else {\r\n        pipeFd = undefined;\r\n        pipeFilename = undefined;\r\n        childApp = undefined;\r\n        restartOnce();\r\n      }\r\n    }\r\n  }\r\n\r\n  function prepareRestart() {\r\n    if (watcherInitialized && childApp) {\r\n      // kill app early as `compile` may take a while\r\n      var restartMessage = program.message ? program.message : \">>> Restarting Api...\";\r\n      console.log(restartMessage);\r\n      killApp();\r\n    } else {\r\n      restartAppInternal();\r\n    }\r\n  }\r\n\r\n  function restartApp() {\r\n    if (!watcherInitialized) return;\r\n    prepareRestart();\r\n  }\r\n\r\n  function restartAppInternal() {\r\n    if (Object.keys(errors).length != 0) {\r\n      // There were some transpilation errors, don't start unless solved or invalid file is removed\r\n      return;\r\n    }\r\n\r\n    pipeFilename = generateTempFilename();\r\n\r\n    if (os.platform() === 'win32') {\r\n      try {\r\n        execSync(`echo. > ${pipeFilename}`);\r\n      } catch (e) {\r\n        console.error(`Unable to create file ${pipeFilename}`);\r\n        process.exit(1);\r\n      }\r\n    } else {\r\n      try {\r\n        execSync(`mkfifo -m 0666 ${pipeFilename}`);\r\n      } catch (e) {\r\n        console.error('Unable to create named pipe with mkfifo. Are you on linux/OSX?');\r\n        process.exit(1);\r\n      }\r\n    }\r\n\r\n    // Support for --debug option\r\n    const runnerExecArgv = process.execArgv.slice();\r\n    if (program.debug) {\r\n      runnerExecArgv.push(typeof (program.debug) === 'boolean'\r\n        ? `--debug`\r\n        : `--debug=${program.debug}`\r\n      )\r\n    }\r\n    // Support for --debug-brk option\r\n    if (program.debugBrk) {\r\n      runnerExecArgv.push('--debug-brk');\r\n    }\r\n    // Support for --inspect option\r\n    if (program.inspect) {\r\n      // Somehow, the default port (2992) is being passed from the node command line. Wipe it out.\r\n      const inspectArg = typeof (program.inspect) === 'boolean'\r\n        ? `--inspect`\r\n        : `--inspect=${program.inspect}`\r\n      runnerExecArgv.push(inspectArg);\r\n    }\r\n    // Support for --inspect-brk option\r\n    if (program.inspectBrk) {\r\n      const inspectBrkArg = typeof (program.inspectBrk) === 'boolean'\r\n        ? `--inspect-brk`\r\n        : `--inspect-brk=${program.inspectBrk}`\r\n      runnerExecArgv.push(inspectBrkArg)\r\n    }\r\n\r\n    const app = fork(path.resolve(__dirname, '__runner__.js'), { execArgv: runnerExecArgv });\r\n\r\n    app.on('message', (data) => {\r\n      if (!data || data.event !== 'babel-watch-filename') return;\r\n      const filename = data.filename;\r\n      if (!program.disableAutowatch) {\r\n        // use relative path for watch.add as it would let chokidar reconsile exclude patterns\r\n        const relativeFilename = path.relative(cwd, filename);\r\n        watcher.add(relativeFilename);\r\n      }\r\n      handleFileLoad(filename, (source, sourceMap) => {\r\n        const sourceBuf = source ? Buffer.from(source) : Buffer.alloc(0);\r\n        const mapBuf = sourceMap ? Buffer.from(JSON.stringify(sourceMap)) : Buffer.alloc(0);\r\n        const lenBuf = Buffer.alloc(4);\r\n        if (pipeFd) {\r\n          try {\r\n            lenBuf.writeUInt32BE(sourceBuf.length, 0);\r\n            fs.writeSync(pipeFd, lenBuf, 0, 4);\r\n            sourceBuf.length && fs.writeSync(pipeFd, sourceBuf, 0, sourceBuf.length);\r\n\r\n            lenBuf.writeUInt32BE(mapBuf.length, 0);\r\n            fs.writeSync(pipeFd, lenBuf, 0, 4);\r\n            mapBuf.length && fs.writeSync(pipeFd, mapBuf, 0, mapBuf.length);\r\n          } catch (error) {\r\n            // EPIPE means `pipeFd` has been closed. We can ignore this\r\n            if (error.code !== 'EPIPE') {\r\n              throw error;\r\n            }\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    app.send({\r\n      event: 'babel-watch-start',\r\n      pipe: pipeFilename,\r\n      args: program.args,\r\n      handleUncaughtExceptions: !program.disableExHandler,\r\n      transpileExtensions: transpileExtensions,\r\n    });\r\n    pipeFd = fs.openSync(pipeFilename, 'w');\r\n    childApp = app;\r\n  }\r\n\r\n  function shouldIgnore(filename) {\r\n    if (transpileExtensions.indexOf(path.extname(filename)) < 0) {\r\n      return true;\r\n    } else if (!ignore && !only) {\r\n      // Ignore node_modules by default\r\n      return path.relative(cwd, filename).split(path.sep).indexOf('node_modules') >= 0;\r\n    } else {\r\n      return babel.util.shouldIgnore(filename, ignore || [], only);\r\n    }\r\n  }\r\n\r\n\r\n  function compile(filename, callback) {\r\n    const optsManager = new babel.OptionManager;\r\n\r\n\r\n\r\n    const opts = optsManager.init({ filename });\r\n    // Do not process config files since has already been done with the OptionManager\r\n    // calls above and would introduce duplicates.\r\n    opts.babelrc = false;\r\n    opts.sourceMaps = true;\r\n    opts.ast = false;\r\n    opts.presets = [require('babel-preset-triframe')]\r\n    opts.plugins = []\r\n\r\n    return babel.transformFile(filename, opts, (err, result) => {\r\n      callback(err, result);\r\n    });\r\n  }\r\n\r\n  restartApp()\r\n}\r\n"],"file":"startApi.js"}