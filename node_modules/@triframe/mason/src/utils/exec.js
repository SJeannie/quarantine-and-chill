import { print } from '.'
const { exec: _exec } = require('child_process')

export const exec = (command, { printOut = false, expectedCodes = [ 0 ] } = {}) => new Promise( (resolve, reject) => {
    let process = _exec(command)
    let stderr = ''
    let stdout = ''
    process.stdout.on('data', data => {
        if(printOut === true) print(data)
        else if(typeof printOut === 'function') printOut(data)
        stdout = `${stdout}${data}`
    })
    process.stderr.on('data', data => stderr = `${stderr}${data}`)
    process.on('exit', code => {
        if(!expectedCodes.includes(code)){
            reject(stderr)
        } else {
            resolve({ stderr, stdout, code })
        }
    })
})