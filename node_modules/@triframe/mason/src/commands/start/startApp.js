import { getState, exec, EnvironmentVariables, getMyIP } from "../../utils"

export const startApp = async () => {
    let state = await getState()
    let apiPort = process.env.API_DEV_PORT || 8080
    let port = process.env.APP_DEV_PORT || 8081
    let environmentVariables = new EnvironmentVariables
    switch(state.platform){
        case 'web':
            environmentVariables.PORT = port
            environmentVariables.REACT_APP_BACKEND_URL = `http://localhost:${apiPort}`
            await exec(`${environmentVariables} react-scripts start`, {
                printOut: true
            })
        break;
        case 'native':
            environmentVariables.REACT_APP_BACKEND_URL = `http://${getMyIP()}:${apiPort}`
            // TODO: Fix this to use the port. Throws stupid "not integer error"
            // environmentVariables.WEB_PORT = port
            // We have to clear the cache because babel won't detect changes in env variables
            await exec(`${environmentVariables} expo start --web --clear`, {
                printOut: true
            })
        break;
    }
}