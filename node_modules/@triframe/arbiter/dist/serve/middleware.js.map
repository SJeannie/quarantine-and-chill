{"version":3,"sources":["../../src/serve/middleware.js"],"names":["corsMiddleware","origin","resolve","includes","credentials","httpRedirectMiddleware","req","res","next","hostname","headers","redirect","originalUrl","formFileParsingMiddleware","form","formidable","IncomingForm","parse","err","fields","files","Object","values","jsonParserMiddleware","bodyParser","json","urlEncodedParserMiddleware","urlencoded","extended","staticFileMiddleware","express","static","path"],"mappings":";;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAGO,MAAMA,cAAc,WAAdA,cAAc,GAAG,oBAAY;AACtCC,EAAAA,MAAM,EAAE,UAAUA,MAAV,EAAkBC,OAAlB,EAA2B;AAC/B,QAAID,MAAM,IAAIA,MAAM,CAACE,QAAP,CAAgB,WAAhB,CAAd,EAA4C;AACxCD,MAAAA,OAAO,CAAC,IAAD,EAAOD,MAAP,CAAP;AACH,KAFD,MAEO;AACHC,MAAAA,OAAO,CAAC,IAAD,EAAO,EAAP,CAAP;AACH;AACJ,GAPqC;AAQtCE,EAAAA,WAAW,EAAE;AARyB,CAAZ,CAAvB;;AAWA,MAAMC,sBAAsB,WAAtBA,sBAAsB,GAAG,UAASC,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAwB;AAC1D,MAAI,CAACF,GAAG,CAACG,QAAJ,CAAaN,QAAb,CAAsB,WAAtB,CAAD,IAAuCG,GAAG,CAACI,OAAJ,CAAY,mBAAZ,MAAqC,MAAhF,EAAwF;AACpFH,IAAAA,GAAG,CAACI,QAAJ,CAAc,WAAUL,GAAG,CAACG,QAAS,GAAEH,GAAG,CAACM,WAAY,EAAvD;AACH,GAFD,MAEO;AACHJ,IAAAA,IAAI;AACP;AACJ,CANM;;AAQA,MAAMK,yBAAyB,WAAzBA,yBAAyB,GAAG,UAASP,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAwB;AAC7D,QAAMM,IAAI,GAAG,IAAIC,qBAAWC,YAAf,EAAb;AACAF,EAAAA,IAAI,CAACG,KAAL,CAAWX,GAAX,EAAgB,CAACY,GAAD,EAAMC,MAAN,EAAcC,KAAd,KAAwB;AACpCd,IAAAA,GAAG,CAACc,KAAJ,GAAYC,MAAM,CAACC,MAAP,CAAcF,KAAd,CAAZ;AACAZ,IAAAA,IAAI;AACP,GAHD;AAIH,CANM;;AAQA,MAAMe,oBAAoB,WAApBA,oBAAoB,GAAGC,qBAAWC,IAAX,EAA7B;;AAEA,MAAMC,0BAA0B,WAA1BA,0BAA0B,GAAGF,qBAAWG,UAAX,CAAsB;AAAEC,EAAAA,QAAQ,EAAE;AAAZ,CAAtB,CAAnC;;AAEA,MAAMC,oBAAoB,WAApBA,oBAAoB,GAAGC,kBAAQC,MAAR,CAAeC,eAAK9B,OAAL,CAAa,UAAb,CAAf,CAA7B","sourcesContent":["import expressCors from 'cors'\r\nimport bodyParser from 'body-parser'\r\nimport formidable from 'formidable'\r\nimport express from 'express'\r\nimport path from 'path'\r\n\r\n\r\nexport const corsMiddleware = expressCors({\r\n    origin: function (origin, resolve) {\r\n        if (origin && origin.includes('localhost')) {\r\n            resolve(null, origin)\r\n        } else {\r\n            resolve(null, '')\r\n        }\r\n    },\r\n    credentials: true\r\n})\r\n\r\nexport const httpRedirectMiddleware = function(req, res, next){\r\n    if (!req.hostname.includes('localhost') && req.headers['x-forwarded-proto'] === 'http') {\r\n        res.redirect(`https://${req.hostname}${req.originalUrl}`)\r\n    } else {\r\n        next()\r\n    }\r\n}\r\n\r\nexport const formFileParsingMiddleware = function(req, res, next){\r\n    const form = new formidable.IncomingForm();\r\n    form.parse(req, (err, fields, files) => {\r\n        req.files = Object.values(files)\r\n        next()\r\n    })\r\n}\r\n\r\nexport const jsonParserMiddleware = bodyParser.json()\r\n\r\nexport const urlEncodedParserMiddleware = bodyParser.urlencoded({ extended: true })\r\n\r\nexport const staticFileMiddleware = express.static(path.resolve('./public'))"],"file":"middleware.js"}